<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Relay Settings</title>
    <style>
      body { font-family: system-ui, sans-serif; margin: 16px; max-width: 760px; }
      h2 { margin-top: 20px; }
      label { display:block; margin-top: 12px; font-weight: 600; }
      input[type="text"] { width: 100%; padding: 8px; box-sizing: border-box; margin-top: 6px; }
      .row { display:flex; gap: 8px; margin-top: 8px; }
      .row > * { flex: 1; }
      button { padding: 8px 12px; }
      .muted { color:#666; font-size: 12px; }
      .section { border: 1px solid #ddd; padding: 12px; border-radius: 8px; margin-top: 12px; }
      .ok { color: #0a0; }
      .bad { color: #a00; }
      .grid { display:grid; grid-template-columns: 1fr auto; gap: 8px 12px; align-items: center; }
      .grid label { margin: 0; }
    </style>
  </head>
  <body>
    <h1>Relay Extension Settings</h1>

    <div class="section">
      <h2>Tracker</h2>
      <label for="trackerUrl">Tracker URL</label>
      <input id="trackerUrl" type="text" placeholder="https://relaynet.online" />
      <div class="row">
        <button id="saveTracker">Save</button>
        <span id="saveTrackerStatus" class="muted"></span>
      </div>
    </div>

    <div class="section">
      <h2>Downloads</h2>
      <div class="grid">
        <label for="allowDownloads">Allow extension to manage downloads</label>
        <button id="allowDownloads">Request Permission</button>
        <label for="autoOpen">Open file after download</label>
        <input id="autoOpen" type="checkbox" />
      </div>
      <div style="margin-top:12px">
        <div class="row">
          <h3 style="margin:0">Managed Torrents</h3>
          <button id="refreshManaged" style="max-width:160px">Refresh</button>
        </div>
        <div id="managedInfo" class="muted" style="margin-top:6px"></div>
        <table id="managedTable" style="width:100%; border-collapse:collapse; margin-top:8px">
          <thead>
            <tr>
              <th style="text-align:left; border-bottom:1px solid #ddd; padding:4px">Backend</th>
              <th style="text-align:left; border-bottom:1px solid #ddd; padding:4px">Hash</th>
              <th style="text-align:left; border-bottom:1px solid #ddd; padding:4px">Name</th>
              <th style="text-align:left; border-bottom:1px solid #ddd; padding:4px">Progress</th>
              <th style="text-align:left; border-bottom:1px solid #ddd; padding:4px">State</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="section">
      <h2>Torrent Backends</h2>
      <h3>qBittorrent</h3>
      <label for="qbtBase">Base URL (e.g., http://127.0.0.1:8080)</label>
      <input id="qbtBase" type="text" placeholder="http://127.0.0.1:8080" />
      <div class="row">
        <button id="qbtPerm">Request Host Permission</button>
        <button id="qbtHealth">Health Check</button>
        <span id="qbtStatus" class="muted"></span>
      </div>

      <h3>Transmission</h3>
      <label for="transBase">RPC URL (e.g., http://127.0.0.1:9091/transmission/rpc)</label>
      <input id="transBase" type="text" placeholder="http://127.0.0.1:9091/transmission/rpc" />
      <div class="row">
        <button id="transPerm">Request Host Permission</button>
        <button id="transHealth">Health Check</button>
        <span id="transStatus" class="muted"></span>
      </div>

      <div class="row">
        <button id="saveBackends">Save Backends</button>
        <span id="saveBackendsStatus" class="muted"></span>
      </div>
    </div>

    <p class="muted">
      Notes: TLS errors on selfâ€‘signed certs cannot be bypassed. Prefer HTTP on localhost for development, or install a valid certificate.
      File access is limited to the Downloads API; opening with the OS default app works for files downloaded by this extension.
    </p>

    <script type="module" src="options.js"></script>
  </body>
  </html>

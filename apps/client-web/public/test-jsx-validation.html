<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSX Transpiler Detailed Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
        .test { margin: 20px 0; padding: 15px; background: #252526; border: 1px solid #3e3e42; border-radius: 4px; }
        .test h3 { color: #4ec9b0; margin-bottom: 10px; }
        .input { background: #1e1e1e; padding: 10px; margin: 5px 0; border-left: 3px solid #569cd6; color: #9cdcfe; }
        .output { background: #1e1e1e; padding: 10px; margin: 5px 0; border-left: 3px solid #6a9955; color: #ce9178; }
        .error { background: #1e1e1e; padding: 10px; margin: 5px 0; border-left: 3px solid #f48771; color: #f48771; }
        pre { overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üî¨ JSX Transpiler Validation</h1>
    
    <div id="results"></div>

    <script>
        async function runTests() {
            const results = document.getElementById('results');
            
            // Test cases: [description, input code]
            const testCases = [
                ['Simple div', '<div>Hello</div>'],
                ['Div with class', '<div className="test">Hello</div>'],
                ['Self-closing', '<div />'],
                ['Component', '<App />'],
                ['Component with props', '<App title="Hello" />'],
                ['Nested elements', '<div><span>Hello</span></div>'],
                ['Text nodes', 'const x = <div>Text</div>;'],
                ['JSX in return', 'return <div>Hello</div>;'],
                ['Export default', 'export default function App() { return <h1>Title</h1>; }'],
                ['get-client.jsx snippet', `
export default async function get(ctx) {
    const path = ctx.url.pathname
    const repo = ctx.url.searchParams.get('repo')
    return <div>
        <h1>{repo}</h1>
        <p>Path: {path}</p>
    </div>
}
`],
            ];
            
            try {
                // Import WASM module
                const mod = await import('/src/wasm/hook_transpiler.js');
                
                // Initialize
                if (typeof mod.default === 'function') {
                    await mod.default();
                }
                
                const transpileFn = mod.transpile_jsx;
                if (typeof transpileFn !== 'function') {
                    results.innerHTML = '<div class="test error">ERROR: transpile_jsx not found</div>';
                    return;
                }
                
                // Run tests
                for (const [desc, code] of testCases) {
                    const result = transpileFn(code, 'test.jsx');
                    const hasError = result.startsWith('TranspileError:');
                    const hasJsx = /<[A-Z]/.test(result);
                    const hasH = result.includes('h(');
                    
                    const test = document.createElement('div');
                    test.className = 'test';
                    test.innerHTML = `
                        <h3>${desc}</h3>
                        <div class="input"><strong>Input:</strong><pre>${escapeHtml(code)}</pre></div>
                        <div class="output"><strong>Output:</strong><pre>${escapeHtml(result)}</pre></div>
                        <div><strong>Status:</strong> 
                            ${hasError ? '<span style="color: #f48771;">‚ùå Error</span>' : 
                              hasJsx ? '<span style="color: #f48771;">‚ùå JSX Still Present</span>' : 
                              hasH ? '<span style="color: #6a9955;">‚úì Transpiled to h()</span>' : 
                              '<span style="color: #dcdcaa;">‚ö† No JSX or h() found</span>'}
                        </div>
                    `;
                    results.appendChild(test);
                }
                
            } catch (e) {
                results.innerHTML = `<div class="test error">ERROR: ${e instanceof Error ? e.message : String(e)}</div>`;
                console.error(e);
            }
        }
        
        function escapeHtml(text) {
            const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
            return text.replace(/[&<>"']/g, m => map[m]);
        }
        
        runTests();
    </script>
</body>
</html>

<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>WASM Runtime Smoke Test</title>
  <style>body{font-family:system-ui, -apple-system, sans-serif;padding:20px}</style>
</head>
<body>
  <h1>WASM Runtime Smoke Test</h1>
  <pre id="log">Starting...
</pre>
  <script>
    const logEl = document.getElementById('log')
    function log(msg){ logEl.textContent += msg + '\n' }

    async function waitForGlobal(name, attempts=60, interval=200){
      for(let i=0;i<attempts;i++){
        if (window[name]) return window[name]
        await new Promise(r=>setTimeout(r, interval))
      }
      return null
    }

    (async function run(){
      log('Waiting for __hook_transpile_jsx...')
      const transpile = await waitForGlobal('__hook_transpile_jsx')
      if (!transpile) { log('✖ __hook_transpile_jsx not present') } else {
        log('✓ __hook_transpile_jsx present — running quick test')
        try{
          const out = transpile('<div class="p-2">Hi</div>', 'test.jsx')
          log('transpile result: ' + (typeof out === 'string' ? out.slice(0,300) : JSON.stringify(out).slice(0,300)))
        }catch(e){ log('transpile call failed: ' + e) }
      }

      log('\nWaiting for __themedStylerRenderCss...')
      const renderCss = await waitForGlobal('__themedStylerRenderCss')
      if (!renderCss) { log('✖ __themedStylerRenderCss not present') } else {
        log('✓ __themedStylerRenderCss present — running quick test')
        try{
          const css = renderCss({ selectors: ['div'], classes: ['p-2'] }, { themes: {}, currentTheme: null })
          log('renderCss result type: ' + typeof css)
          log('renderCss result preview:\n' + String(css).slice(0,1000))
        }catch(e){ log('renderCss call failed: ' + e) }
      }

      log('\nDone.')
    })()
  </script>
</body>
</html>
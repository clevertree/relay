<!DOCTYPE html>
<html>
<head>
    <title>WASM Test</title>
</head>
<body>
    <h1>Testing WASM Transpiler</h1>
    <pre id="log" style="background: #f0f0f0; padding: 10px; border-radius: 4px; overflow: auto;"></pre>
    <script type="module">
        const log = (msg) => {
            console.log(msg);
            const el = document.getElementById('log');
            el.textContent += msg + '\n';
            el.scrollTop = el.scrollHeight;
        };

        log('Starting test...');
        log('Importing WASM module from src/wasm...');

        (async () => {
            try {
                // Import from src/wasm (not public/wasm)
                const { default: init, transpile_jsx } = await import('/src/wasm/hook_transpiler.js');
                
                log('Module imported, initializing WASM...');
                await init();
                log('✓ WASM initialized');
                
                // Test cases
                const tests = [
                    { name: 'Simple div', input: '<div>Hello</div>' },
                    { name: 'Self-closing', input: '<div />' },
                    { name: 'With className', input: '<div className="test">Content</div>' },
                    { name: 'Component', input: '<MyButton />' },
                    { name: 'With pragma', input: '/** @jsx h */\n<div>Test</div>' },
                ];

                log('\n=== JSX Transpilation Tests ===\n');
                
                let passed = 0;
                for (const test of tests) {
                    try {
                        const result = transpile_jsx(test.input);
                        const success = result.code.includes('h(');
                        
                        if (success) {
                            log(`✓ ${test.name}`);
                            log(`  Input:  ${test.input}`);
                            log(`  Output: ${result.code.substring(0, 60)}...`);
                            passed++;
                        } else {
                            log(`✗ ${test.name} - JSX not converted to h()`);
                            log(`  Output: ${result.code}`);
                        }
                    } catch (err) {
                        log(`✗ ${test.name} - Error: ${err.message}`);
                    }
                }
                
                log(`\n✓ Tests complete: ${passed}/${tests.length} passed`);
                
            } catch (err) {
                log(`✗ Fatal error: ${err.message}`);
                log(`Stack: ${err.stack}`);
            }
        })();
    </script>
</body>
</html>
